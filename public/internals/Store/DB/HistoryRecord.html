<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Store::DB::HistoryRecord
  
    &mdash; Silo Service
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (H)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Store.html" title="Store (module)">Store</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../DB.html" title="Store::DB (module)">DB</a></span></span>
     &raquo; 
    <span class="title">HistoryRecord</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Store::DB::HistoryRecord
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Store::DB::HistoryRecord</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">DataMapper::Resource</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>TODO: we want to populate a size field as well, need to add a size here,
and  perhaps a latest_size on package record.  For now, we’re just using
the size info from package to ensure we’re getting the functional
interface correct - see the silo mixins.</p>


  </div>
</div>
<div class="tags">
  

</div>

  


  

  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#actions-class_method" title="actions (class method)">+ (Object) <strong>actions</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-class_method" title="delete (class method)">+ (Object) <strong>delete</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>(package_record) or (silo_record, package_name).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fixity-class_method" title="fixity (class method)">+ (Object) <strong>fixity</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>(package_record, hashes) or (silo_record, package_name, hashes).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list-class_method" title="list (class method)">+ (Object) <strong>list</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>called with either a (package_record) or (silo_record, package_name) as
arguments.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#missing-class_method" title="missing (class method)">+ (Object) <strong>missing</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>just like self.fixity, but with null md5 and sha1 values.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put-class_method" title="put (class method)">+ (Object) <strong>put</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>HistoryRecord.put(package_record, hash) or  HistoryRecord(silo_record,
package_name, hash).</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="actions-class_method">
  
    + (<tt>Object</tt>) <strong>actions</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


499
500
501</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 499</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='actions identifier id'>actions</span>
  <span class='lbrack token'>[</span> <span class='symbol val'>:put</span><span class='comma token'>,</span> <span class='symbol val'>:fixity</span><span class='comma token'>,</span> <span class='symbol val'>:delete</span> <span class='rbrack token'>]</span>    <span class='comment val'># implicity ordering historical workflow here.</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete-class_method">
  
    + (<tt>Object</tt>) <strong>delete</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>(package_record) or (silo_record, package_name)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


598
599
600
601
602
603
604
605
606
607
608
609
610</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 598</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>  
  <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
    <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span>  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - delete - can't look up the package based on arguments (#{args.join(', ')}).&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='PackageRecord constant id'>PackageRecord</span>
    <span class='history_record identifier id'>history_record</span> <span class='assign token'>=</span> <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='now identifier id'>now</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
    <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:package_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='package_record identifier id'>package_record</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:delete</span> <span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - delete - can't create a new DELETE record for package #{package_record} - #{history_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - delete - can't update the existence field for package #{package_record} - #{package_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='history_record identifier id'>history_record</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="fixity-class_method">
  
    + (<tt>Object</tt>) <strong>fixity</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>(package_record, hashes) or (silo_record, package_name, hashes)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


583
584
585
586
587
588
589
590
591
592
593
594
595
596</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 583</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fixity identifier id'>fixity</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>  
  <span class='hashes identifier id'>hashes</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
  <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:timestamp</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='unless unless_mod kw'>unless</span> <span class='hashes identifier id'>hashes</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='symbol val'>:timestamp</span>
  <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
    <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span>  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - fixity - can't look up the package based on arguments (#{args.join(', ')}).&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='PackageRecord constant id'>PackageRecord</span>
    <span class='history_record identifier id'>history_record</span> <span class='assign token'>=</span> <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:package_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='package_record identifier id'>package_record</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:fixity</span><span class='comma token'>,</span> <span class='symbol val'>:md5</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:md5</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:sha1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:sha1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:timestamp</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - fixity - can't create a new FIXITY record for package #{package_record} - #{history_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:latest_sha1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:sha1</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  <span class='symbol val'>:latest_md5</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:md5</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  <span class='symbol val'>:latest_timestamp</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hashes identifier id'>hashes</span><span class='lbrack token'>[</span><span class='symbol val'>:timestamp</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - fixity - can't update current md5 and sha1 records in FIXITY record for package #{package_record} - #{package_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='history_record identifier id'>history_record</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="list-class_method">
  
    + (<tt>Object</tt>) <strong>list</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>called with either a (package_record) or (silo_record, package_name) as
arguments</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 516</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='list identifier id'>list</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span>  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='lparen token'>(</span><span class='symbol val'>:package_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='package_record identifier id'>package_record</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:timestamp</span><span class='dot token'>.</span><span class='asc identifier id'>asc</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="missing-class_method">
  
    + (<tt>Object</tt>) <strong>missing</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>just like self.fixity, but with null md5 and sha1 values</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


614
615
616
617
618
619
620
621
622
623
624
625
626
627
628</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 614</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='missing identifier id'>missing</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>  
  <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
    <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span>  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>

    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - missing - can't look up the package based on arguments (#{args.join(', ')}).&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='PackageRecord constant id'>PackageRecord</span>
    <span class='history_record identifier id'>history_record</span> <span class='assign token'>=</span> <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='now identifier id'>now</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
    <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:package_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='package_record identifier id'>package_record</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:fixity</span><span class='comma token'>,</span> <span class='symbol val'>:md5</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:sha1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='now identifier id'>now</span> <span class='rbrace token'>}</span>

    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - missing - can't create a new MISSING record for package #{package_record} - #{history_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:latest_sha1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:latest_md5</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:latest_timestamp</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='now identifier id'>now</span> <span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - missing - can't update the existence field for package #{package_record} - #{package_record.errors.full_messages.join('; ')}.&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='history_record identifier id'>history_record</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="put-class_method">
  
    + (<tt>Object</tt>) <strong>put</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>HistoryRecord.put(package_record, hash) or  HistoryRecord(silo_record,
package_name, hash)</p>

<p>hash must have the following attributes:</p>

<pre class="code"><span class='mult op'>*</span> <span class='md5 identifier id'>md5</span>
<span class='mult op'>*</span> <span class='sha1 identifier id'>sha1</span>
<span class='mult op'>*</span> <span class='timestamp identifier id'>timestamp</span>
<span class='mult op'>*</span> <span class='size identifier id'>size</span>
<span class='mult op'>*</span> <span class='type identifier id'>type</span>
</pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/db.rb', line 531</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='put identifier id'>put</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>  

  <span class='hashargs identifier id'>hashargs</span>       <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>

  <span class='lbrack token'>[</span> <span class='symbol val'>:md5</span><span class='comma token'>,</span> <span class='symbol val'>:sha1</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span><span class='comma token'>,</span> <span class='symbol val'>:size</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Problem creating historical PUT record: missing #{key.to_s} data&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='hashargs identifier id'>hashargs</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='key identifier id'>key</span>
  <span class='end end kw'>end</span>

  <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='md5 identifier id'>md5</span>  <span class='assign token'>=</span> <span class='hashargs identifier id'>hashargs</span><span class='lbrack token'>[</span><span class='symbol val'>:md5</span><span class='rbrack token'>]</span>
  <span class='sha1 identifier id'>sha1</span> <span class='assign token'>=</span> <span class='hashargs identifier id'>hashargs</span><span class='lbrack token'>[</span><span class='symbol val'>:sha1</span><span class='rbrack token'>]</span>
  <span class='time identifier id'>time</span> <span class='assign token'>=</span> <span class='hashargs identifier id'>hashargs</span><span class='lbrack token'>[</span><span class='symbol val'>:timestamp</span><span class='rbrack token'>]</span>

  <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>

    <span class='yield yield kw'>yield</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>

    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='package_record identifier id'>package_record</span>
      <span class='package_record identifier id'>package_record</span> <span class='assign token'>=</span> <span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='hashargs identifier id'>hashargs</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>


    <span class='history_record identifier id'>history_record</span> <span class='assign token'>=</span> <span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:package_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='package_record identifier id'>package_record</span><span class='comma token'>,</span>
                                  <span class='symbol val'>:action</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put</span><span class='comma token'>,</span> 
                                  <span class='symbol val'>:md5</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='md5 identifier id'>md5</span><span class='comma token'>,</span> 
                                  <span class='symbol val'>:sha1</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sha1 identifier id'>sha1</span><span class='comma token'>,</span> 
                                  <span class='symbol val'>:timestamp</span>      <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='time identifier id'>time</span> <span class='rbrace token'>}</span>

    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='history_record identifier id'>history_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - put - can't create a new PUT record for package #{package_record} - #{history_record.errors.full_messages.join('; ')}.&quot;</span> 
    <span class='end end kw'>end</span>

    <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:initial_sha1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sha1 identifier id'>sha1</span><span class='comma token'>,</span> 
                                  <span class='symbol val'>:latest_sha1</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sha1 identifier id'>sha1</span><span class='comma token'>,</span>

                                  <span class='symbol val'>:initial_md5</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='md5 identifier id'>md5</span><span class='comma token'>,</span>
                                  <span class='symbol val'>:latest_md5</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='md5 identifier id'>md5</span><span class='comma token'>,</span>

                                  <span class='symbol val'>:initial_timestamp</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='time identifier id'>time</span><span class='comma token'>,</span>
                                  <span class='symbol val'>:latest_timestamp</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='time identifier id'>time</span><span class='comma token'>,</span>

                                  <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='package_record identifier id'>package_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;HistoryRecord - put - can't create current md5 and sha1 records in PUT for package #{package_record} - #{package_record.errors.full_messages.join('; ')}.&quot;</span> 
    <span class='end end kw'>end</span>

    <span class='history_record identifier id'>history_record</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Nov 21 17:48:11 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.8.7).
</div>

  </body>
</html>