<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Store::Fixity</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (F)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Store.html" title="Store (module)">Store</a></span></span>
     &raquo; 
    <span class="title">Fixity</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Store::Fixity
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="SiloDB.html" title="Store::SiloDB (class)">SiloDB</a></span>, <span class='object_link'><a href="SiloTape.html" title="Store::SiloTape (class)">SiloTape</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb</dd>
  
</dl>
<div class="clear"></div>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#oldest_fixity-instance_method" title="#oldest_fixity (instance method)">- (Object) <strong>oldest_fixity</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
For all the existing packages on this silo, get the times of the current
fixity checks, and return the date of earliest of them.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#package_count-instance_method" title="#package_count (instance method)">- (Object) <strong>package_count</strong>(search = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
TODO: these need to be pulled out into different more appropriately named
mixin, or just back into DB, maybe:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#package_fixity_report-instance_method" title="#package_fixity_report (instance method)">- (Object) <strong>package_fixity_report</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#package_names-instance_method" title="#package_names (instance method)">- (Object) <strong>package_names</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
TODO: see above - these three don&#8217;t really belong here either:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#package_names_by_page-instance_method" title="#package_names_by_page (instance method)">- (Object) <strong>package_names_by_page</strong>(page, number_per_page, search = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#silo_fixity_report-instance_method" title="#silo_fixity_report (instance method)">- (Object) <strong>silo_fixity_report</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Here&#8217;s the sort of serializations that fixity needs to support (XML
here, but JSON and CSV possible):.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="oldest_fixity-instance_method">
  
    - (<tt>Object</tt>) <strong>oldest_fixity</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
For all the existing packages on this silo, get the times of the current
fixity checks, and return the date of earliest of them.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 144</span>

<span class='def def kw'>def</span> <span class='oldest_fixity identifier id'>oldest_fixity</span> 
  <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='min identifier id'>min</span><span class='lparen token'>(</span><span class='symbol val'>:latest_timestamp</span><span class='comma token'>,</span> <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:silo_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='silo_record identifier id'>silo_record</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="package_count-instance_method">
  
    - (<tt>Object</tt>) <strong>package_count</strong>(search = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
TODO: these need to be pulled out into different more appropriately named
mixin, or just back into DB, maybe:
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 150</span>

<span class='def def kw'>def</span> <span class='package_count identifier id'>package_count</span> <span class='search identifier id'>search</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='search identifier id'>search</span>
    <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:silo_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> <span class='symbol val'>:name</span><span class='dot token'>.</span><span class='like identifier id'>like</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;%#{search}%&quot;</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:silo_record</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='silo_record identifier id'>silo_record</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="package_fixity_report-instance_method">
  
    - (<tt>Object</tt>) <strong>package_fixity_report</strong>(name) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 183</span>

<span class='def def kw'>def</span> <span class='package_fixity_report identifier id'>package_fixity_report</span> <span class='name identifier id'>name</span>

  <span class='comment val'>### TODO: we're going to extend history records to include sizes, and change package records</span>
  <span class='comment val'>### to have initial_size and latest_size.  Step one of the refactoring is to use the 'size'</span>
  <span class='comment val'>### record from the host</span>

  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='pkg identifier id'>pkg</span> <span class='assign token'>=</span> <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>

  <span class='fixity_records identifier id'>fixity_records</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='deleted_on identifier id'>deleted_on</span>      <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='created_on identifier id'>created_on</span>      <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='count identifier id'>count</span>           <span class='assign token'>=</span> <span class='integer val'>0</span> 
  <span class='max_time identifier id'>max_time</span>        <span class='assign token'>=</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='string val'>'1970-01-01'</span><span class='rparen token'>)</span>
  <span class='min_time identifier id'>min_time</span>        <span class='assign token'>=</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
  <span class='history_records identifier id'>history_records</span> <span class='assign token'>=</span> <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='HistoryRecord constant id'>HistoryRecord</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>  <span class='comment val'>### TODO: list raw here, perhaps, for speedup</span>

  <span class='history_records identifier id'>history_records</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span>        
    <span class='case case kw'>case</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='action identifier id'>action</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:put</span>
      <span class='fixity_records identifier id'>fixity_records</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
      <span class='fixity_records identifier id'>fixity_records</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrace token'>{</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='action identifier id'>action</span><span class='comma token'>,</span>
                            <span class='symbol val'>:md5</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='md5 identifier id'>md5</span><span class='comma token'>,</span> 
                            <span class='symbol val'>:sha1</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='sha1 identifier id'>sha1</span><span class='comma token'>,</span> 
                            <span class='symbol val'>:size</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>            <span class='comment val'># see TODO above</span>
                            <span class='symbol val'>:time</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:fixity</span>
      <span class='count identifier id'>count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='fixity_records identifier id'>fixity_records</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrace token'>{</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='action identifier id'>action</span><span class='comma token'>,</span>
                            <span class='symbol val'>:md5</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='md5 identifier id'>md5</span><span class='comma token'>,</span> 
                            <span class='symbol val'>:sha1</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='sha1 identifier id'>sha1</span><span class='comma token'>,</span> 
                            <span class='symbol val'>:time</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span><span class='comma token'>,</span>
                            <span class='symbol val'>:size</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>            <span class='comment val'># see TODO above</span>
                            <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='md5 identifier id'>md5</span> <span class='eq op'>==</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='initial_md5 identifier id'>initial_md5</span> <span class='and and kw'>and</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='sha1 identifier id'>sha1</span> <span class='eq op'>==</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='initial_sha1 identifier id'>initial_sha1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:ok</span> <span class='colon op'>:</span> <span class='symbol val'>:fail</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:delete</span>
      <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='fixity_records identifier id'>fixity_records</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>   <span class='comment val'># start over</span>
    <span class='end end kw'>end</span>

    <span class='max_time identifier id'>max_time</span> <span class='assign token'>=</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='gt op'>&gt;</span> <span class='max_time identifier id'>max_time</span> <span class='integer val'>? </span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='colon op'>:</span> <span class='max_time identifier id'>max_time</span>
    <span class='min_time identifier id'>min_time</span> <span class='assign token'>=</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='lt op'>&lt;</span> <span class='min_time identifier id'>min_time</span> <span class='integer val'>? </span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='colon op'>:</span> <span class='min_time identifier id'>min_time</span>
  <span class='end end kw'>end</span>

  <span class='OpenStruct constant id'>OpenStruct</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:filesystem</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='filesystem identifier id'>filesystem</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:hostname</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hostname identifier id'>hostname</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:package</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span>
                 <span class='symbol val'>:fixity_records</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='fixity_records identifier id'>fixity_records</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:fixity_check_count</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='count identifier id'>count</span><span class='comma token'>,</span>
                 <span class='symbol val'>:first_fixity_check</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='min_time identifier id'>min_time</span><span class='comma token'>,</span>
                 <span class='symbol val'>:last_fixity_check</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='max_time identifier id'>max_time</span><span class='comma token'>,</span>
                 <span class='symbol val'>:created</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='created_on identifier id'>created_on</span><span class='comma token'>,</span>
                 <span class='symbol val'>:deleted</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='deleted_on identifier id'>deleted_on</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="package_names-instance_method">
  
    - (<tt>Object</tt>) <strong>package_names</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
TODO: see above - these three don&#8217;t really belong here either:
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 160</span>

<span class='def def kw'>def</span> <span class='package_names identifier id'>package_names</span>
  <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="package_names_by_page-instance_method">
  
    - (<tt>Object</tt>) <strong>package_names_by_page</strong>(page, number_per_page, search = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 164</span>

<span class='def def kw'>def</span> <span class='package_names_by_page identifier id'>package_names_by_page</span> <span class='page identifier id'>page</span><span class='comma token'>,</span> <span class='number_per_page identifier id'>number_per_page</span><span class='comma token'>,</span> <span class='search identifier id'>search</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='search identifier id'>search</span>
    <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> 
                                   <span class='symbol val'>:order</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:initial_timestamp</span><span class='dot token'>.</span><span class='desc identifier id'>desc</span> <span class='rbrack token'>]</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:name</span><span class='dot token'>.</span><span class='like identifier id'>like</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;%#{search}%&quot;</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:extant</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:limit</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='number_per_page identifier id'>number_per_page</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:offset</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='number_per_page identifier id'>number_per_page</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='page identifier id'>page</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> 
                                   <span class='symbol val'>:order</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:initial_timestamp</span><span class='dot token'>.</span><span class='desc identifier id'>desc</span> <span class='rbrack token'>]</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:limit</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='number_per_page identifier id'>number_per_page</span><span class='comma token'>,</span>
                                   <span class='symbol val'>:offset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='number_per_page identifier id'>number_per_page</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='page identifier id'>page</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='names identifier id'>names</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="silo_fixity_report-instance_method">
  
    - (<tt>Object</tt>) <strong>silo_fixity_report</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Here&#8217;s the sort of serializations that fixity needs to support (XML
here, but JSON and CSV possible):
</p>
<p>
<SILOCHECK silo=&#8221;/daitssfs/016&#8221;
host=&#8220;fclnx31.fcla.edu&#8221; fixity_check_count=&#8220;4507&#8221;
first_fixity_check=&#8220;2010-02-24T11:21:52-05:00&#8221;
last_fixity_check=&#8220;2010-03-24T10:02:25-04:00&#8221;>
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='FIXITY constant id'>FIXITY</span> <span class='name identifier id'>name</span><span class='assign token'>=</span><span class='string val'>&quot;E20090617_AAABSY&quot;</span> <span class='sha1 identifier id'>sha1</span><span class='assign token'>=</span><span class='string val'>&quot;20638e5c667193b8cf42b5da4ad9e98e89ca3466&quot;</span> <span class='md5 identifier id'>md5</span><span class='assign token'>=</span><span class='string val'>&quot;689b007da0d135210dab6abda1b62edd&quot;</span> <span class='time identifier id'>time</span><span class='assign token'>=</span><span class='string val'>&quot;2010-02-24T12:25:21-05:00&quot;</span> <span class='status identifier id'>status</span><span class='assign token'>=</span><span class='string val'>&quot;ok&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='FIXITY constant id'>FIXITY</span> <span class='name identifier id'>name</span><span class='assign token'>=</span><span class='string val'>&quot;E20090617_AAABTA&quot;</span> <span class='sha1 identifier id'>sha1</span><span class='assign token'>=</span><span class='string val'>&quot;bc758033d20981c7310b1574d97b07b02b5aa910&quot;</span> <span class='md5 identifier id'>md5</span><span class='assign token'>=</span><span class='string val'>&quot;86ae8ae50fce2fc9d5cd00d29efb4f41&quot;</span> <span class='time identifier id'>time</span><span class='assign token'>=</span><span class='string val'>&quot;2010-02-24T11:52:41-05:00&quot;</span> <span class='status identifier id'>status</span><span class='assign token'>=</span><span class='string val'>&quot;ok&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='dot3 op'>...</span><span class='dot token'>.</span>
</pre>
<p>
</SILOCHECK>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/silomixins.rb', line 245</span>

<span class='def def kw'>def</span> <span class='silo_fixity_report identifier id'>silo_fixity_report</span>
  <span class='fixity_records identifier id'>fixity_records</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='count identifier id'>count</span>          <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='max_time identifier id'>max_time</span>       <span class='assign token'>=</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='string val'>'1970-01-01'</span><span class='rparen token'>)</span>
  <span class='min_time identifier id'>min_time</span>       <span class='assign token'>=</span> <span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span>

  <span class='DB constant id'>DB</span><span class='colon2 op'>::</span><span class='PackageRecord constant id'>PackageRecord</span><span class='dot token'>.</span><span class='raw_list identifier id'>raw_list</span><span class='lparen token'>(</span><span class='silo_record identifier id'>silo_record</span><span class='comma token'>,</span> <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span>
    <span class='fixity_records identifier id'>fixity_records</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='lbrace token'>{</span> <span class='symbol val'>:name</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> 
                          <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_md5 identifier id'>latest_md5</span> <span class='eq op'>==</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='initial_md5 identifier id'>initial_md5</span> <span class='and and kw'>and</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_sha1 identifier id'>latest_sha1</span> <span class='eq op'>==</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='initial_sha1 identifier id'>initial_sha1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:ok</span> <span class='colon op'>:</span> <span class='symbol val'>:fail</span><span class='comma token'>,</span>
                          <span class='symbol val'>:md5</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_md5 identifier id'>latest_md5</span><span class='comma token'>,</span> 
                          <span class='symbol val'>:sha1</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_sha1 identifier id'>latest_sha1</span><span class='comma token'>,</span> 
                          <span class='symbol val'>:size</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>                  <span class='comment val'># see TODO above about renaming these fields to intial_ and latest_ size</span>
                          <span class='symbol val'>:time</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_timestamp identifier id'>latest_timestamp</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>

    <span class='max_time identifier id'>max_time</span> <span class='assign token'>=</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_timestamp identifier id'>latest_timestamp</span> <span class='gt op'>&gt;</span> <span class='max_time identifier id'>max_time</span> <span class='integer val'>? </span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_timestamp identifier id'>latest_timestamp</span> <span class='colon op'>:</span> <span class='max_time identifier id'>max_time</span>
    <span class='min_time identifier id'>min_time</span> <span class='assign token'>=</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_timestamp identifier id'>latest_timestamp</span> <span class='lt op'>&lt;</span> <span class='min_time identifier id'>min_time</span> <span class='integer val'>? </span><span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='latest_timestamp identifier id'>latest_timestamp</span> <span class='colon op'>:</span> <span class='min_time identifier id'>min_time</span>
    <span class='count identifier id'>count</span>   <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='OpenStruct constant id'>OpenStruct</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:filesystem</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='filesystem identifier id'>filesystem</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:hostname</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hostname identifier id'>hostname</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:fixity_records</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='fixity_records identifier id'>fixity_records</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:fixity_check_count</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='count identifier id'>count</span><span class='comma token'>,</span>
                 <span class='symbol val'>:first_fixity_check</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='min_time identifier id'>min_time</span><span class='comma token'>,</span> 
                 <span class='symbol val'>:last_fixity_check</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='max_time identifier id'>max_time</span><span class='rparen token'>)</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu May 12 23:41:56 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>