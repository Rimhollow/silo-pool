<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: MySqlTableMixIn::Table</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (T)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../MySqlTableMixIn.html" title="MySqlTableMixIn (module)">MySqlTableMixIn</a></span></span>
     &raquo; 
    <span class="title">Table</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: MySqlTableMixIn::Table
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">MySqlTableMixIn::Table</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb</dd>
  
</dl>
<div class="clear"></div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="EquiJoinTable.html" title="MySqlTableMixIn::EquiJoinTable (class)">EquiJoinTable</a></span>, <span class='object_link'><a href="HistoriesTable.html" title="MySqlTableMixIn::HistoriesTable (class)">HistoriesTable</a></span>, <span class='object_link'><a href="PackagesTable.html" title="MySqlTableMixIn::PackagesTable (class)">PackagesTable</a></span>, <span class='object_link'><a href="SiloLogsTable.html" title="MySqlTableMixIn::SiloLogsTable (class)">SiloLogsTable</a></span>, <span class='object_link'><a href="SilosTable.html" title="MySqlTableMixIn::SilosTable (class)">SilosTable</a></span></p>
</div>


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#data_dictionary-instance_method" title="#data_dictionary (instance method)">- (Object) <strong>data_dictionary</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute data_dictionary.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#dbh-instance_method" title="#dbh (instance method)">- (Object) <strong>dbh</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute dbh.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#fields-instance_method" title="#fields (instance method)">- (Object) <strong>fields</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute fields.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#record_constructor-instance_method" title="#record_constructor (instance method)">- (Object) <strong>record_constructor</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute record_constructor.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#table_name-instance_method" title="#table_name (instance method)">- (Object) <strong>table_name</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute table_name.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#clauses-instance_method" title="#clauses (instance method)">- (Object) <strong>clauses</strong>(where, order, limit) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
&#8216;WHERE     expects a string that gives conditions, e.g.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">- (Object) <strong>count</strong>(where = nil, order = nil, limit = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
count [ where-clause ] [ order-clause ] [ limit-clause ].
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (Object) <strong>delete</strong>(where = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ids-instance_method" title="#ids (instance method)">- (Object) <strong>ids</strong>(where = nil, order = nil, limit = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
ids [ where-clause ] [ order-clause ] [ limit-clause ].
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Table) <strong>initialize</strong>(connection, table_name, *fields) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of Table.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#insert-instance_method" title="#insert (instance method)">- (Object) <strong>insert</strong>(record) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
id and version should not, in general, be set on these;.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_record-instance_method" title="#new_record (instance method)">- (Object) <strong>new_record</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Return an empty record for an insert.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#prep-instance_method" title="#prep (instance method)">- (Object) <strong>prep</strong>(record, *discards) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Quote the elements in a record as necessary.
</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#query-instance_method" title="#query (instance method)">- (Object) <strong>query</strong>(query_string) </a>
    

    
  </span>
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Query is for rapid return of array of arrays; normally you&#8217;ll want to
use select.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quote-instance_method" title="#quote (instance method)">- (Object) <strong>quote</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#select-instance_method" title="#select (instance method)">- (Object) <strong>select</strong>(where = nil, order = nil, limit = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong>(record) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="MySqlTableMixIn::Table (class)">Table</a></span></tt>) <strong>initialize</strong>(connection, table_name, *fields) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of Table
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 364</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='connection identifier id'>connection</span><span class='comma token'>,</span> <span class='table_name identifier id'>table_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='fields identifier id'>fields</span>

  <span class='@dbh ivar id'>@dbh</span>  <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='dbh identifier id'>dbh</span>
  <span class='@table_name ivar id'>@table_name</span>  <span class='assign token'>=</span> <span class='table_name identifier id'>table_name</span>

  <span class='comment val'># bring in _quote, _query and _fields, transact block, etc, etc</span>

  <span class='case case kw'>case</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='vendor identifier id'>vendor</span>
  <span class='when when kw'>when</span> <span class='string val'>'postgres'</span>
    <span class='extend identifier id'>extend</span> <span class='PostgresTableMixIn constant id'>PostgresTableMixIn</span>
  <span class='when when kw'>when</span> <span class='string val'>'mysql'</span>
    <span class='extend identifier id'>extend</span> <span class='MySqlTableMixIn constant id'>MySqlTableMixIn</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Unsupported database #{connection.vendor}. Supported databases: 'mysql', 'postgres'.&quot;</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='@fields ivar id'>@fields</span> <span class='assign token'>=</span> <span class='_get_fields identifier id'>_get_fields</span><span class='lparen token'>(</span><span class='@table_name ivar id'>@table_name</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='@fields ivar id'>@fields</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='@fields ivar id'>@fields</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='string val'>'version'</span> <span class='unless unless_mod kw'>unless</span> <span class='@fields ivar id'>@fields</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='string val'>'version'</span>   <span class='comment val'># we always need these</span>
  <span class='@fields ivar id'>@fields</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='string val'>'id'</span>      <span class='unless unless_mod kw'>unless</span> <span class='@fields ivar id'>@fields</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='string val'>'id'</span>

  <span class='struct_name identifier id'>struct_name</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='vendor identifier id'>vendor</span><span class='dot token'>.</span><span class='capitalize identifier id'>capitalize</span> <span class='plus op'>+</span> <span class='string val'>'_'</span> <span class='plus op'>+</span> <span class='ConnectionId constant id'>ConnectionId</span><span class='dot token'>.</span><span class='next identifier id'>next</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='string val'>'_'</span> <span class='plus op'>+</span> <span class='table_name identifier id'>table_name</span><span class='dot token'>.</span><span class='capitalize identifier id'>capitalize</span>

  <span class='@record_constructor ivar id'>@record_constructor</span> <span class='assign token'>=</span> <span class='Struct constant id'>Struct</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='struct_name identifier id'>struct_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='lparen token'>(</span><span class='@fields ivar id'>@fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='comma token'>,</span> <span class='string val'>'_'</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='@data_dictionary ivar id'>@data_dictionary</span>    <span class='assign token'>=</span> <span class='_build_data_dictionary identifier id'>_build_data_dictionary</span> <span class='table_name identifier id'>table_name</span><span class='comma token'>,</span> <span class='@fields ivar id'>@fields</span>

  <span class='comment val'># Ensure our connection works up front</span>

  <span class='begin begin kw'>begin</span>
    <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Can't connect to #{vendor} database #{database}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='_query identifier id'>_query</span><span class='lparen token'>(</span><span class='string val'>&quot;SELECT 1+1&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="data_dictionary-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="data_dictionary-instance_method">
  
    - (<tt>Object</tt>) <strong>data_dictionary</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute data_dictionary
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 362</span>

<span class='def def kw'>def</span> <span class='data_dictionary identifier id'>data_dictionary</span>
  <span class='@data_dictionary ivar id'>@data_dictionary</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="dbh-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="dbh-instance_method">
  
    - (<tt>Object</tt>) <strong>dbh</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute dbh
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 362</span>

<span class='def def kw'>def</span> <span class='dbh identifier id'>dbh</span>
  <span class='@dbh ivar id'>@dbh</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="fields-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="fields-instance_method">
  
    - (<tt>Object</tt>) <strong>fields</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute fields
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 362</span>

<span class='def def kw'>def</span> <span class='fields identifier id'>fields</span>
  <span class='@fields ivar id'>@fields</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="record_constructor-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="record_constructor-instance_method">
  
    - (<tt>Object</tt>) <strong>record_constructor</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute record_constructor
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 362</span>

<span class='def def kw'>def</span> <span class='record_constructor identifier id'>record_constructor</span>
  <span class='@record_constructor ivar id'>@record_constructor</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="table_name-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="table_name-instance_method">
  
    - (<tt>Object</tt>) <strong>table_name</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute table_name
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 362</span>

<span class='def def kw'>def</span> <span class='table_name identifier id'>table_name</span>
  <span class='@table_name ivar id'>@table_name</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clauses-instance_method">
  
    - (<tt>Object</tt>) <strong>clauses</strong>(where, order, limit)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
&#8216;WHERE     expects a string that gives conditions, e.g.
&#8220;filesystem like &#8217;%silos%&#8217; AND id < 100&#8221;
&#8216;ORDER BY&#8217; e.g. &#8220;field DESC&#8221; or &#8220;field1,
field2&#8221; &#8216;LIMIT&#8217;    expects a string like
&#8220;<number>&#8221; or even &#8220;<number> OFFSET <start>&#8221;
(sqlite, postgress, mysql extension)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519
520
521
522</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 516</span>

<span class='def def kw'>def</span> <span class='clauses identifier id'>clauses</span> <span class='where identifier id'>where</span><span class='comma token'>,</span> <span class='order identifier id'>order</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span>
  <span class='phrase identifier id'>phrase</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='lparen token'>(</span><span class='where identifier id'>where</span> <span class='integer val'>? </span><span class='dstring node'>&quot;WHERE #{where}&quot;</span>    <span class='colon op'>:</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span><span class='comma token'>,</span>
             <span class='lparen token'>(</span><span class='order identifier id'>order</span> <span class='integer val'>? </span><span class='dstring node'>&quot;ORDER BY #{order}&quot;</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span><span class='comma token'>,</span>
             <span class='lparen token'>(</span><span class='limit identifier id'>limit</span> <span class='integer val'>? </span><span class='dstring node'>&quot;LIMIT #{limit}&quot;</span>    <span class='colon op'>:</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>

  <span class='phrase identifier id'>phrase</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>  <span class='integer val'>? </span><span class='string val'>''</span> <span class='colon op'>:</span> <span class='string val'>' '</span> <span class='plus op'>+</span> <span class='phrase identifier id'>phrase</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="count-instance_method">
  
    - (<tt>Object</tt>) <strong>count</strong>(where = nil, order = nil, limit = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
count [ where-clause ] [ order-clause ] [ limit-clause ]
</p>
<p>
Count the records to be returned for given conditions.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


445
446
447
448</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 445</span>

<span class='def def kw'>def</span> <span class='count identifier id'>count</span> <span class='where identifier id'>where</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='comment val'># query returns something like [ ['number'] ]</span>
  <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SELECT COUNT(*) FROM #{table_name}&quot;</span> <span class='plus op'>+</span> <span class='clauses identifier id'>clauses</span><span class='lparen token'>(</span><span class='where identifier id'>where</span><span class='comma token'>,</span> <span class='order identifier id'>order</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete-instance_method">
  
    - (<tt>Object</tt>) <strong>delete</strong>(where = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 437</span>

<span class='def def kw'>def</span> <span class='delete identifier id'>delete</span> <span class='where identifier id'>where</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='_modify identifier id'>_modify</span> <span class='dstring node'>&quot;DELETE FROM #{table_name}&quot;</span> <span class='plus op'>+</span> <span class='clauses identifier id'>clauses</span><span class='lparen token'>(</span><span class='where identifier id'>where</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ids-instance_method">
  
    - (<tt>Object</tt>) <strong>ids</strong>(where = nil, order = nil, limit = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
ids [ where-clause ] [ order-clause ] [ limit-clause ]
</p>
<p>
Return the ids for the given conditions; useful for sub-selects.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


454
455
456
457</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 454</span>

<span class='def def kw'>def</span> <span class='ids identifier id'>ids</span> <span class='where identifier id'>where</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='comment val'># query returns something like [ ['id-1'], ['id-2'] ... ]</span>
  <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SELECT id FROM #{table_name}&quot;</span> <span class='plus op'>+</span> <span class='clauses identifier id'>clauses</span><span class='lparen token'>(</span><span class='where identifier id'>where</span><span class='comma token'>,</span> <span class='order identifier id'>order</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='bitor op'>|</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="insert-instance_method">
  
    - (<tt>Object</tt>) <strong>insert</strong>(record) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
id and version should not, in general, be set on these;
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Store/DataBaseError.html" title="Store::DataBaseError (class)">Store::DataBaseError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 482</span>

<span class='def def kw'>def</span> <span class='insert identifier id'>insert</span> <span class='record identifier id'>record</span>

  <span class='keys identifier id'>keys</span><span class='comma token'>,</span> <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='prep identifier id'>prep</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='string val'>'id'</span><span class='rparen token'>)</span>

  <span class='number_affected identifier id'>number_affected</span> <span class='assign token'>=</span> <span class='_modify identifier id'>_modify</span> <span class='dstring node'>&quot;INSERT INTO #{table_name}(#{keys.join(', ')}) VALUES(#{vals.join(', ')})&quot;</span>

  <span class='comment val'># could we get the id from this?  We lose track of our default values.</span>

  <span class='if if kw'>if</span> <span class='number_affected identifier id'>number_affected</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='id identifier id'>id</span> <span class='assign token'>=</span> <span class='_last_insert_id identifier id'>_last_insert_id</span>
    <span class='true true kw'>true</span>
  <span class='else else kw'>else</span>
    <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

<span class='rescue rescue kw'>rescue</span> <span class='PGError constant id'>PGError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='DataBaseError constant id'>DataBaseError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Postgres Insert error: #{e.message}&quot;</span>
<span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='DataBaseError constant id'>DataBaseError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Insert error: #{e.message}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new_record-instance_method">
  
    - (<tt>Object</tt>) <strong>new_record</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Return an empty record for an insert. Beware setting the ID - most always
you&#8217;ll want to leave it empty. Most fields default to :undefined and
will not be used in an update or insert.  Set what you need to.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


407
408
409
410
411</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 407</span>

<span class='def def kw'>def</span> <span class='new_record identifier id'>new_record</span>
  <span class='rec identifier id'>rec</span> <span class='assign token'>=</span><span class='@record_constructor ivar id'>@record_constructor</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='members identifier id'>members</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span> <span class='rec identifier id'>rec</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='symbol val'>:undefined</span> <span class='rbrace token'>}</span>
  <span class='rec identifier id'>rec</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="prep-instance_method">
  
    - (<tt>Object</tt>) <strong>prep</strong>(record, *discards)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Quote the elements in a record as necessary.  Return two arrays: a subset
of the field names, and values, possibly quoted.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 539</span>

<span class='def def kw'>def</span> <span class='prep identifier id'>prep</span> <span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='discards identifier id'>discards</span>

  <span class='keys identifier id'>keys</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='data_dictionary identifier id'>data_dictionary</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='info identifier id'>info</span><span class='bitor op'>|</span>  <span class='comment val'># we get these in field order</span>
    <span class='field_name identifier id'>field_name</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span>
    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='record identifier id'>record</span><span class='lbrack token'>[</span><span class='field_name identifier id'>field_name</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:undefined</span>  <span class='comment val'># new records are born with this default.</span>
    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='discards identifier id'>discards</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='field_name identifier id'>field_name</span>
    <span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='field_name identifier id'>field_name</span>
    <span class='if if kw'>if</span> <span class='record identifier id'>record</span><span class='lbrack token'>[</span><span class='field_name identifier id'>field_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='vals identifier id'>vals</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='string val'>'NULL'</span>
    <span class='else else kw'>else</span>
      <span class='vals identifier id'>vals</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:integer?</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='record identifier id'>record</span><span class='lbrack token'>[</span><span class='field_name identifier id'>field_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='colon op'>:</span> <span class='quote identifier id'>quote</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='lbrack token'>[</span><span class='field_name identifier id'>field_name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='keys identifier id'>keys</span><span class='comma token'>,</span> <span class='vals identifier id'>vals</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="query-instance_method">
  
    - (<tt>Object</tt>) <strong>query</strong>(query_string)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Query is for rapid return of array of arrays; normally you&#8217;ll want to
use select.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


526
527
528
529
530
531
532
533
534</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 526</span>

<span class='def def kw'>def</span> <span class='query identifier id'>query</span> <span class='query_string identifier id'>query_string</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='_query identifier id'>_query</span><span class='lparen token'>(</span><span class='query_string identifier id'>query_string</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span> <span class='row identifier id'>row</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='rows identifier id'>rows</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='_query identifier id'>_query</span><span class='lparen token'>(</span><span class='query_string identifier id'>query_string</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span> <span class='rows identifier id'>rows</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='row identifier id'>row</span> <span class='rbrace token'>}</span>
    <span class='return return kw'>return</span> <span class='rows identifier id'>rows</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="quote-instance_method">
  
    - (<tt>Object</tt>) <strong>quote</strong>(string) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


504
505
506
507
508</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 504</span>

<span class='def def kw'>def</span> <span class='quote identifier id'>quote</span> <span class='string identifier id'>string</span>
  <span class='return return kw'>return</span> <span class='string val'>'NULL'</span> <span class='if if_mod kw'>if</span> <span class='string identifier id'>string</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='return return kw'>return</span> <span class='string val'>'NULL'</span> <span class='if if_mod kw'>if</span> <span class='string identifier id'>string</span> <span class='match op'>=~</span> <span class='regexp val'>/^NULL$/i</span>
  <span class='return return kw'>return</span> <span class='string val'>&quot;'&quot;</span> <span class='plus op'>+</span> <span class='_escape identifier id'>_escape</span><span class='lparen token'>(</span><span class='string identifier id'>string</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot;'&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="select-instance_method">
  
    - (<tt>Object</tt>) <strong>select</strong>(where = nil, order = nil, limit = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 413</span>

<span class='def def kw'>def</span> <span class='select identifier id'>select</span> <span class='where identifier id'>where</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='procs identifier id'>procs</span> <span class='assign token'>=</span> <span class='data_dictionary identifier id'>data_dictionary</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span> <span class='rec identifier id'>rec</span><span class='lbrack token'>[</span><span class='symbol val'>:cast</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>         <span class='comment val'># array of cast procs or nils, in field order.</span>
  <span class='needs_cast identifier id'>needs_cast</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='procs identifier id'>procs</span><span class='dot token'>.</span><span class='each_index identifier id'>each_index</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='needs_cast identifier id'>needs_cast</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='i identifier id'>i</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='procs identifier id'>procs</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>  <span class='comment val'># column indexes of procs from above we'll need to apply.</span>

  <span class='sql identifier id'>sql</span> <span class='assign token'>=</span>  <span class='dstring node'>&quot;SELECT #{fields.join(', ')} FROM #{table_name}&quot;</span> <span class='plus op'>+</span> <span class='clauses identifier id'>clauses</span><span class='lparen token'>(</span><span class='where identifier id'>where</span><span class='comma token'>,</span> <span class='order identifier id'>order</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='_query identifier id'>_query</span><span class='lparen token'>(</span><span class='sql identifier id'>sql</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span>
      <span class='needs_cast identifier id'>needs_cast</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='procs identifier id'>procs</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
      <span class='yield yield kw'>yield</span>  <span class='@record_constructor ivar id'>@record_constructor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='row identifier id'>row</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

  <span class='else else kw'>else</span>
    <span class='list identifier id'>list</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='_query identifier id'>_query</span><span class='lparen token'>(</span><span class='sql identifier id'>sql</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='row identifier id'>row</span><span class='bitor op'>|</span>
      <span class='needs_cast identifier id'>needs_cast</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='procs identifier id'>procs</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
      <span class='list identifier id'>list</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='@record_constructor ivar id'>@record_constructor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='row identifier id'>row</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='list identifier id'>list</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong>(record) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/datyl/tables.rb', line 459</span>

<span class='def def kw'>def</span> <span class='update identifier id'>update</span> <span class='record identifier id'>record</span>

  <span class='keys identifier id'>keys</span><span class='comma token'>,</span> <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='prep identifier id'>prep</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='string val'>'id'</span><span class='comma token'>,</span> <span class='string val'>'version'</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;No version set in this record. Did you mean to do an insert here?&quot;</span> <span class='if if_mod kw'>if</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='eq op'>==</span> <span class='symbol val'>:undefined</span>

  <span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='string val'>'version'</span>
  <span class='vals identifier id'>vals</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='plus op'>+</span> <span class='integer val'>1</span>

  <span class='settings identifier id'>settings</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span> <span class='vals identifier id'>vals</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{key}=#{val}&quot;</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span>

  <span class='number_affected identifier id'>number_affected</span> <span class='assign token'>=</span> <span class='_modify identifier id'>_modify</span> <span class='dstring node'>&quot;UPDATE #{table_name} SET #{settings} WHERE id=#{record.id} and version=#{record.version}&quot;</span>

  <span class='if if kw'>if</span> <span class='number_affected identifier id'>number_affected</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='assign token'>=</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='version identifier id'>version</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
    <span class='true true kw'>true</span>
  <span class='else else kw'>else</span>
    <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu May 12 23:41:43 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>