<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: TsmStream</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (T)</a> &raquo; 
    
    
    <span class="title">TsmStream</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: TsmStream
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ArrayBasedStream.html" title="ArrayBasedStream (class)">ArrayBasedStream</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="ArrayBasedStream.html" title="ArrayBasedStream (class)">ArrayBasedStream</a></span></li>
          
            <li class="next">TsmStream</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/fixityutils.rb</dd>
  
</dl>
<div class="clear"></div>



  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (TsmStream) <strong>initialize</strong>(filesystem, tape_server, reporter) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
tsm.list returns an array of Structs, with accessors .path (String), .mtime
(Time), .size (Fixnum) - sorted on .path we just have to break out the path
as key.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ArrayBasedStream.html" title="ArrayBasedStream (class)">ArrayBasedStream</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ArrayBasedStream.html#close-instance_method" title="ArrayBasedStream#close (method)">#close</a></span>, <span class='object_link'><a href="ArrayBasedStream.html#eos%3F-instance_method" title="ArrayBasedStream#eos? (method)">#eos?</a></span>, <span class='object_link'><a href="ArrayBasedStream.html#get-instance_method" title="ArrayBasedStream#get (method)">#get</a></span>, <span class='object_link'><a href="ArrayBasedStream.html#rewind-instance_method" title="ArrayBasedStream#rewind (method)">#rewind</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="TsmStream (class)">TsmStream</a></span></tt>) <strong>initialize</strong>(filesystem, tape_server, reporter) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
tsm.list returns an array of Structs, with accessors .path (String), .mtime
(Time), .size (Fixnum) - sorted on .path we just have to break out the path
as key.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/silo-pool/lib/store/fixityutils.rb', line 272</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='filesystem identifier id'>filesystem</span><span class='comma token'>,</span> <span class='tape_server identifier id'>tape_server</span><span class='comma token'>,</span> <span class='reporter identifier id'>reporter</span>
  <span class='@index ivar id'>@index</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@list ivar id'>@list</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='filesystem identifier id'>filesystem</span> <span class='assign token'>=</span> <span class='filesystem identifier id'>filesystem</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>%r{/+$}</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>'/'</span>

  <span class='tsm identifier id'>tsm</span> <span class='assign token'>=</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='TsmExecutor constant id'>TsmExecutor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='tape_server identifier id'>tape_server</span><span class='comma token'>,</span> <span class='integer val'>120</span><span class='rparen token'>)</span>
  <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='lparen token'>(</span><span class='filesystem identifier id'>filesystem</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span>
    <span class='@list ivar id'>@list</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='lbrack token'>[</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='rec identifier id'>rec</span> <span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='path identifier id'>path</span> <span class='match op'>=~</span> <span class='regexp val'>/\.lock$/</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># list is sorted by tsm.list; status of 0 or 4 is OK; 8 may</span>
  <span class='comment val'># be. 12 definitely isn't.</span>

  <span class='if if kw'>if</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='status identifier id'>status</span> <span class='gt op'>&gt;</span> <span class='integer val'>8</span>
    <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='dstring node'>&quot;Command '#{tsm.command}', exited with status #{tsm.status}. This is a fatal error and processing will be stopped.&quot;</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='string val'>&quot;Tivoli error log follows:&quot;</span>
      <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='line identifier id'>line</span><span class='bitor op'>|</span> <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='output identifier id'>output</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='string val'>&quot;Tivoli output log follows:&quot;</span>
      <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='output identifier id'>output</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='line identifier id'>line</span><span class='bitor op'>|</span> <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='string val'>&quot;An error occured in Tivoli processing. Giving up on fixity checking this tape.&quot;</span>
    <span class='raise identifier id'>raise</span> <span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='FatalFixityError constant id'>FatalFixityError</span><span class='comma token'>,</span> <span class='string val'>&quot;Can't continue - Tivloi reported errors&quot;</span>

  <span class='elsif elsif kw'>elsif</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='status identifier id'>status</span> <span class='gt op'>&gt;</span> <span class='integer val'>4</span>
    <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;Command '#{tsm.command}', exited with status #{tsm.status}. Some warnings occured.  Check the following Tivoli log messages if fixity errors occur.&quot;</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='string val'>&quot;Tivoli error log follows:&quot;</span>
      <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='line identifier id'>line</span><span class='bitor op'>|</span> <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='output identifier id'>output</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='string val'>&quot;Tivoli output log follows:&quot;</span>
      <span class='tsm identifier id'>tsm</span><span class='dot token'>.</span><span class='output identifier id'>output</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='line identifier id'>line</span><span class='bitor op'>|</span> <span class='reporter identifier id'>reporter</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


</div>
    
    <div id="footer">
  Generated on Thu May 12 23:42:38 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>